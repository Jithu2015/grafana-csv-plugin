{"version":3,"sources":["../src/query_ctrl.js"],"names":["_","QueryCtrl","PanelEvents","FileDatasourceQueryCtrl","$scope","$injector","target","alias","query","format","formats","text","value","panelCtrl","events","on","dataReceived","onDataReceived","bind","dataError","onDataError","dataList","lastQueryMeta","lastQueryError","anySeriesFromQuery","find","refId","meta","err","data","results","queryRes","error","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,O;;AACEC,e,kBAAAA,S;;AACAC,iB,gBAAAA,W;;;;;;;;;;;;;;;;;;;;;AAEYC,6B;;;AACnB,yCAAYC,MAAZ,EAAoBC,SAApB,EAA+B;AAAA;;AAAA,wJACvBD,MADuB,EACfC,SADe;;AAG7B,gBAAKC,MAAL,CAAYC,KAAZ,GAAoB,EAApB;AACA,gBAAKD,MAAL,CAAYE,KAAZ,GAAoB,MAAKF,MAAL,CAAYE,KAAZ,IAAqB,qCAAzC;;AAEA;AACA,gBAAKF,MAAL,CAAYG,MAAZ,GAAqB,MAAKH,MAAL,CAAYG,MAAZ,IAAsB,OAA3C;AACA,gBAAKC,OAAL,GAAe,CACb,EAAEC,MAAM,aAAR,EAAuBC,OAAO,aAA9B,EADa,EAEb,EAAED,MAAM,OAAR,EAAiBC,OAAO,OAAxB,EAFa,CAAf;;AAKA,gBAAKC,SAAL,CAAeC,MAAf,CAAsBC,EAAtB,CAAyBb,YAAYc,YAArC,EAAmD,MAAKC,cAAL,CAAoBC,IAApB,OAAnD,EAAmFd,MAAnF;AACA,gBAAKS,SAAL,CAAeC,MAAf,CAAsBC,EAAtB,CAAyBb,YAAYiB,SAArC,EAAgD,MAAKC,WAAL,CAAiBF,IAAjB,OAAhD,EAA6Ed,MAA7E;AAd6B;AAe9B;;;;yCAEciB,Q,EAAU;AACvB,iBAAKC,aAAL,GAAqB,IAArB;AACA,iBAAKC,cAAL,GAAsB,IAAtB;AACA,gBAAMC,qBAAqBxB,EAAEyB,IAAF,CAAOJ,QAAP,EAAiB,EAAEK,OAAO,KAAKpB,MAAL,CAAYoB,KAArB,EAAjB,CAA3B;AACA,gBAAIF,kBAAJ,EAAwB;AACtB,mBAAKF,aAAL,GAAqBE,mBAAmBG,IAAxC;AACD;AACF;;;sCAEWC,G,EAAK;AACf,gBAAIA,IAAIC,IAAJ,IAAYD,IAAIC,IAAJ,CAASC,OAAzB,EAAkC;AAChC,kBAAMC,WAAWH,IAAIC,IAAJ,CAASC,OAAT,CAAiB,KAAKxB,MAAL,CAAYoB,KAA7B,CAAjB;AACA,kBAAIK,QAAJ,EAAc;AACZ,qBAAKT,aAAL,GAAqBS,SAASJ,IAA9B;AACA,qBAAKJ,cAAL,GAAsBQ,SAASC,KAA/B;AACD;AACF;AACF;;;;QAnCkD/B,S;;yBAAhCE,uB;;AAsCrBA,8BAAwB8B,WAAxB,GAAsC,4BAAtC","file":"query_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport { QueryCtrl } from 'app/plugins/sdk';\nimport { PanelEvents } from '@grafana/data';\n\nexport default class FileDatasourceQueryCtrl extends QueryCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n\n    this.target.alias = '';\n    this.target.query = this.target.query || 'SELECT * FROM DataTable LIMIT 1, 15';\n\n    // FORMAT\n    this.target.format = this.target.format || 'table';\n    this.formats = [\n      { text: 'Time series', value: 'time_series' },\n      { text: 'Table', value: 'table' },\n    ];\n\n    this.panelCtrl.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this), $scope);\n    this.panelCtrl.events.on(PanelEvents.dataError, this.onDataError.bind(this), $scope);\n  }\n\n  onDataReceived(dataList) {\n    this.lastQueryMeta = null;\n    this.lastQueryError = null;\n    const anySeriesFromQuery = _.find(dataList, { refId: this.target.refId });\n    if (anySeriesFromQuery) {\n      this.lastQueryMeta = anySeriesFromQuery.meta;\n    }\n  }\n\n  onDataError(err) {\n    if (err.data && err.data.results) {\n      const queryRes = err.data.results[this.target.refId];\n      if (queryRes) {\n        this.lastQueryMeta = queryRes.meta;\n        this.lastQueryError = queryRes.error;\n      }\n    }\n  }\n}\n\nFileDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}